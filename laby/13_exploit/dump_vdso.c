#include <stdio.h>
#include <unistd.h>
#include <fcntl.h>
#include <string.h>

int main()
{
#define LINE_LEN 256
	char line[LINE_LEN];
	FILE *maps = fopen("/proc/self/maps", "r");
	if (!maps) {
		perror("fopen");
		return 1;
	}
	while (fgets(line, LINE_LEN, maps)) {
		if (strstr(line, "[vdso]")) {
			unsigned long addr;
			int err;
			err = sscanf(line, "%lx-", &addr);
			if (err != 1) {
				fprintf(stderr, "Unexpected format: %s\n", line);
				return 1;
			}
			err = write(1, (char*)addr, 4096);
			if (err != 4096) {
				if (err >= 0)
					fprintf(stderr, "write: short write (%d)\n", err);
				else
					perror("write");
				return 1;
			}
			return 0;
		}
	}
	fprintf(stderr, "No vdso-related line found!");
	return 1;
}
