
<!-- saved from url=(0047)http://www.mimuw.edu.pl/~mengel/SO/zad2iso.html -->
<HTML><HEAD><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-2">
<TITLE>SO - Zadanie zaliczeniowe 2</TITLE>

</HEAD><BODY>

<H1>ZADANIE ZALICZENIOWE NR 2</H1>

<P>
Nale¿y napisaæ w C serwer wielow±tkowy wykonuj±cy zlecone operacje na grafie, a tak¿e prosty program kliencki wysy³aj±cy i odbieraj±cy zlecenia.

</P><H2>Klient</H2>

<P>
Klient powinien uruchamiaæ siê poleceniem<BR>
<KBD>./klient <VAR>polecenie</VAR> <VAR>argumenty...</VAR></KBD><BR>
gdzie <VAR>polecenie</VAR> jest pojedynczym znakiem informuj±cym o rodzaju polecenia, a <VAR>argumenty</VAR> s± liczbami ca³kowitymi dodatnimi (mieszcz±cymi siê w typie <CODE>int</CODE>), których liczba i znaczenie zale¿y od polecenia.

</P><P>
Program wysy³a polecenie opisane w argumentach do serwera, po wykonaniu polecenia przez serwer odbiera odpowied¼ i w zale¿no¶ci od odpowiedzi koñczy siê z odpowiednim statusem. W przypadku niektórych poleceñ wypisuje tak¿e komunikat na standardowe wyj¶cie.

</P><H2>Serwer i w±tki</H2>
<P>
Serwer powinien uruchamiaæ siê poleceniem<BR>
<KBD>./serwer <VAR>N</VAR> <VAR>X</VAR> <VAR>T</VAR></KBD>
</P><P>
Mo¿na za³o¿yæ, ¿e parametry s± poprawne. Parametry s± liczbami ca³kowitymi i oznaczaj±:
</P><DL>
<DT><VAR>N</VAR>
</DT><DD>liczbê wierzcho³ków grafu, 1&lt;=<VAR>N</VAR>&lt;=50
</DD><DT><VAR>X</VAR>
</DT><DD>maksymaln± liczbê w±tków dzia³aj±cych jednocze¶nie, 1&lt;=<VAR>X</VAR>&lt;=50
</DD><DT><VAR>T</VAR>
</DT><DD>maksymalny czas oczekiwania w puli bezczynnych w±tków, w sekundach, zero oznacza brak oczekiwania (pula zawsze pusta), 0&lt;=<VAR>T</VAR>&lt;=60
</DD></DL>

<P>
Serwer powinien w pêtli odbieraæ komunikaty ze zleceniami od klientów i inicjowaæ wykonanie zleceñ przez w±tki. Do obs³ugi zlecenia powinien byæ u¿yty wolny w±tek z puli bezczynnych w±tków, a je¶li takiego nie ma i nie osi±gniêto jeszcze <VAR>N</VAR> w±tków, powinien zostaæ utworzony nowy w±tek. Je¶li dzia³a <VAR>N</VAR> w±tków, wówczas kolejne zlecenie zostanie obs³u¿one dopiero po zwolnieniu jednego z w±tków.

</P><P>
W±tek realizuje zadane zlecenie i (bez po¶rednictwa g³ównego w±tku serwera) wysy³a odpowied¼ do klienta. Po zrealizowaniu zlecenia w±tek powinien zaj±æ siê obs³ug± kolejnego nieobs³u¿onego zlecenia. Je¶li nie ma kolejnego zlecenia do realizacji, w±tek trafia do puli i oczekuje na zlecenie maksymalnie <VAR>T</VAR> sekund; je¶li w tym czasie nie zostanie wykorzystany do obs³ugi zlecenia, w±tek koñczy siê.

</P><P>
Gdy serwer otrzyma jeden z sygna³ów <CODE>SIGINT</CODE>, <CODE>SIGHUP</CODE>, <CODE>SIGTERM</CODE> powinien poczekaæ na zakoñczenie wykonywania bie¿±cych zleceñ przez w±tki, a nastêpnie po odczekaniu 1 sekundy, zakoñczyæ siê, zwalniaj±c zasoby.

</P><H2>Graf i operacje</H2>
<P>
Serwer wykonuje operacje na grafie skierowanym o <VAR>N</VAR> wierzcho³kach numerowanych od <VAR>0</VAR> do <VAR>N-1</VAR>. Krawêdzie posiadaj± wagi, które s± liczbami ca³kowitymi z przedzia³u <VAR>[1,&nbsp;99]</VAR>. Pocz±tkowo graf nie posiada ¿adnej krawêdzi.
</P><P>
Graf mo¿na (ale nie jest to wymaganie) reprezentowaæ jako tablicê <VAR>N</VAR>*<VAR>N</VAR> o warto¶ciach równych wagom lub 0 w przypadku braku krawêdzi.

</P><P>
Operacje:
</P><DL>
<DT>dodanie krawêdzi
</DT><DD>
<P>
Parametry klienta:<BR>
<CODE>+ <VAR>V</VAR> <VAR>W</VAR> <VAR>G</VAR></CODE><BR>
gdzie <VAR>V</VAR> i <VAR>W</VAR> to numery wierzcho³ków

</P><P>
Powoduje dodanie krawêdzi skierowanej z <VAR>V</VAR> do <VAR>W</VAR> o wadze <VAR>G</VAR> lub ustawia wagê je¶li taka krawêd¼ ju¿ istnieje.

</P><P>
Klient powinien zwróciæ kod zakoñczenia 0 w przypadku dodania krawêdzi, 1 w przypadku gdy krawêd¼ ju¿ istnia³a (niezale¿nie od tego czy waga uleg³a zmianie), -1 w przypadku b³êdu (np. numer wierzcho³ka poza zakresem).

</P></DD><DT>usuniêcie krawêdzi
</DT><DD>
<P>
Parametry klienta:<BR>
<CODE>- <VAR>V</VAR> <VAR>W</VAR></CODE>
</P><P>
Powoduje usuniêcie krawêdzi skierowanej z <VAR>V</VAR> do <VAR>W</VAR>.
Je¶li takiej krawêdzi nie ma, nic nie zmienia.

</P><P>
Klient powinien zwróciæ kod zakoñczenia 0 w przypadku usuniêcia krawêdzi, 1 w przypadku gdy krawêd¼ nie istnia³a, -1 w przypadku b³êdu (np. numer wierzcho³ka poza zakresem).

</P></DD><DT>znalezienie cyklu Hamiltona
</DT><DD>
<P>
Parametry klienta:<BR>
<CODE>H <VAR>W<SUB>1</SUB></VAR> <VAR>W<SUB>2</SUB></VAR> ... <VAR>W<SUB>m</SUB></VAR></CODE><BR>
Mo¿na za³o¿yæ, ¿e <VAR>m&lt;=50</VAR> oraz ¿e wierzcho³ki siê nie powtarzaj±.
</P><P>
Powoduje wyszukanie cyklu Hamiltona o minimalnej wadze w podgrafie z³o¿onym z wierzcho³ków <VAR>W<SUB>1</SUB></VAR> ... <VAR>W<SUB>m</SUB></VAR>, o ile taki cykl istnieje. Mo¿na u¿yæ naiwnego algorytmu wyszukiwania.
</P><P>
Na wyj¶ciu klienta pojawia siê informacja opisana przez wiersz:<BR>
<CODE>H <VAR>waga</VAR></CODE><BR>
gdzie <VAR>waga</VAR> to <CODE>0</CODE> w przypadku braku cyklu Hamiltona, waga znalezionego cyklu w przypadku jego znalezienia, <CODE>-1</CODE> w przypadku b³êdu (np. numer wierzcho³ka poza zakresem).<BR>
</P><P>
Status zwracany przez klienta: 0 w przypadku znalezienia cyklu, 1 w przypadku braku cyklu, -1 w przypadku b³êdu.
</P></DD></DL>

<H2>Komunikacja i synchronizacja</H2>
<P>
Klienty komunikuj± siê z serwerem i jego w±tkami przez kolejkê/kolejki IPC. Do realizacji w±tków nale¿y u¿yæ biblioteki <CODE>pthread</CODE>.

</P><P>
W±tki serwera operuj± na wspólnych strukturach danych, synchronizuj±c dostêp za pomoc± mutexów i zmiennych warunkowych. Dostêp do grafu ma byæ chroniony na zasadzie czytelników i pisarzy na poziomie pojedynczych wierzcho³ków. Rozmiar struktur danych s³u¿±cych synchronizacji mo¿e byæ <VAR>O(N)</VAR>.

</P><H2>Pozosta³e informacje</H2>

<P>Na standardowe wyj¶cie mog± byæ wypisywane jedynie komunikaty opisane w tre¶ci. Inne komunikaty (o b³êdach, diagnostyczne - oby jak najmniej) powinny byæ wypisywane na <CODE>stderr</CODE>.

</P><P>Rozwi±zania w jêzyku C (tylko Makefile, pliki ¼ród³owe i opcjonalny plik z opisem)
nale¿y nadsy³aæ na adres solab@mimuw.edu.pl ze swoich kont pocztowych 
na komputerze students za pomoc± skryptu 
<A href="http://www.mimuw.edu.pl/~mengel/SO/PUBLIC-SO/submit/submit">submit</A>. Rozwi±zania przes³ane w inny
sposób nie bed± sprawdzane. W plikach ¼ród³owych musi znale¼æ siê komentarz 
z imieniem i nazwiskiemi autora.

</P><P>
Ostateczny termin nadsy³ania rozwi±zañ: 7 grudnia 2009, 23:59</P>

<P>W przypadku w±tpliwo¶ci mo¿na zadaæ pytanie autorowi zadania
<A href="mailto:czarnik@mimuw.edu.pl">Patrykowi Czarnikowi</A><A></A></P><A>


<H2>Uzupe³nienia</H2>
<OL>
<LI>Dopuszczalne jest czytanie zleceñ z kolejki bezpo¶rednio przez w±tki "robocze" i utrzymywanie przy ¿yciu jednego w±tku nawet przy braku zleceñ.
</LI><LI>Mo¿na u¿yæ mechanizmu pthread_rwlock.

</LI><LI>Argumenty klienta i serwera s± poprawne sk³adniowo, ale nale¿y sprawdzaæ (i powinien to robiæ dopiero serwer) czy numer wierzcho³ka jest mniejszy od <VAR>N</VAR>.

</LI><LI>Kolejka/i IPC mo¿e byæ publiczna i dowolnie (np. poprzez sta³± w kodzie) mo¿na ustalaæ wspólny klucz dla serwera i klienta.

</LI><LI><VAR>X</VAR> to liczba w±tków "roboczych", a poza nimi jest g³ówny w±tek serwera.

</LI><LI>Kolejno¶æ wybierania w±tków z puli mo¿e byæ dowolna.

</LI><LI>"Naiwny algorytm" to taki, który sprawdza wszystkie mo¿liwo¶ci i wybiera najlepsz±. Tak, to mo¿e trwaæ d³ugo.

</LI><LI>Struktury danych o rozmiarze zale¿nym od <VAR>N</VAR> powinny byæ alokowane dynamicznie na podstawie warto¶ci argumentu <VAR>N</VAR>, a nie statycznie dla rozmiaru 50.

</LI></OL>


</A></BODY></HTML>